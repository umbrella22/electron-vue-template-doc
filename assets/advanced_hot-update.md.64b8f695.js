import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.5bf30b3a.js";const b=JSON.parse('{"title":"热更新","description":"","frontmatter":{},"headers":[],"relativePath":"advanced/hot-update.md","filePath":"advanced/hot-update.md","lastUpdated":1686747207000}'),p={name:"advanced/hot-update.md"},e=l(`<h1 id="热更新" tabindex="-1">热更新 <a class="header-anchor" href="#热更新" aria-label="Permalink to &quot;热更新&quot;">​</a></h1><p><strong>热更新可以不需要重新下载安装的情况下更新渲染进程的内容，主进程也是允许的，但是需要确保没有添加或者删除原生依赖（.node 后缀）</strong></p><p>若要启用热更新你需要做以下准备</p><p><strong>在 config/index.ts 文件中的 build 对象找到<code> hotPublishUrl</code> <code>hotPublishConfigName </code></strong></p><ol><li><p>需要一个能够无权限访问的公网地址；类型为域名、ip、有无 https 都可以</p></li><li><p>设置 hotPublishUrl，该参数应为完整的 url,比如<code>https://www.xxxxx.com</code></p></li><li><p>设置 hotPublishConfigName，该参数为拼接在 url 后面的文件名称，是热更新的下载配置文件</p></li></ol><p>例如：</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;"># 若hotPublishUrl值为：https://www.xxxxx.com</span></span>
<span class="line"><span style="color:#6A737D;"># 若hotPublishConfigName值为：update-config</span></span>
<span class="line"><span style="color:#6A737D;"># 最终得到的热更新链接为</span></span>
<span class="line"><span style="color:#B392F0;">https://www.xxxxx.com/update-config.json</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;"># 若hotPublishUrl值为：https://www.xxxxx.com</span></span>
<span class="line"><span style="color:#6A737D;"># 若hotPublishConfigName值为：update-config</span></span>
<span class="line"><span style="color:#6A737D;"># 最终得到的热更新链接为</span></span>
<span class="line"><span style="color:#6F42C1;">https://www.xxxxx.com/update-config.json</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>此处给出完整 url 的拼接规则是为了让你能够检查该 url 是否可用</strong></p><ol start="4"><li>执行<code>build</code>命令，等待命令完成后，执行<code>pack:resources</code>命令</li></ol><p>例如</p><div class="language-sh vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#B392F0;">yarn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">build</span></span>
<span class="line"><span style="color:#6A737D;"># 一些控制台输出，等待成功</span></span>
<span class="line"><span style="color:#B392F0;">yarn</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">pack:resources</span></span>
<span class="line"><span style="color:#6A737D;"># 若打包成功资源，此处会显示如下输出，其中文件位置，为热更新打包产物位置</span></span>
<span class="line"><span style="color:#6A737D;"># The resource file is packaged!</span></span>
<span class="line"><span style="color:#6A737D;"># File location: &quot;文件位置&quot;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6F42C1;">yarn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">build</span></span>
<span class="line"><span style="color:#6A737D;"># 一些控制台输出，等待成功</span></span>
<span class="line"><span style="color:#6F42C1;">yarn</span><span style="color:#24292E;"> </span><span style="color:#032F62;">pack:resources</span></span>
<span class="line"><span style="color:#6A737D;"># 若打包成功资源，此处会显示如下输出，其中文件位置，为热更新打包产物位置</span></span>
<span class="line"><span style="color:#6A737D;"># The resource file is packaged!</span></span>
<span class="line"><span style="color:#6A737D;"># File location: &quot;文件位置&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="5"><li><p>请在第四步控制台输出的文件目录中找到第三步中<code>hotPublishConfigName</code>的值对应的 json 文件和同级目录下的<code>.zip</code>压缩包一同放到<code>hotPublishUrl</code>所指向的服务器目录中</p></li><li><p>在渲染进程中调用<code>ipcRenderer.invoke(&quot;hot-update&quot;)</code>方法即可启动热更新程序</p></li></ol><p>例如</p><div class="language-TypeScript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">TypeScript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// 省略部分代码</span></span>
<span class="line"><span style="color:#B392F0;">checkUpgrade</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 请注意，ipcRenderer为electron提供的ipcRenderer方法</span></span>
<span class="line"><span style="color:#E1E4E8;">    ipcRenderer.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;hot-update&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// 省略部分代码</span></span>
<span class="line"><span style="color:#6F42C1;">checkUpgrade</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 请注意，ipcRenderer为electron提供的ipcRenderer方法</span></span>
<span class="line"><span style="color:#24292E;">    ipcRenderer.</span><span style="color:#6F42C1;">invoke</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;hot-update&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="7"><li>通过<code>ipcRenderer.on(&quot;hot-update-status&quot;)</code>即可监听到热更新程序的状态，该事件的值和对应原因如下表</li></ol><div class="language-TypeScript vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">TypeScript</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">type</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">updateInfo</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">status</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#FFAB70;">message</span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">string</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#6A737D;">// 省略部分代码</span></span>
<span class="line"><span style="color:#B392F0;">checkUpgrade</span><span style="color:#E1E4E8;">(){</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// 请注意，ipcRenderer为electron提供的ipcRenderer方法</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#B392F0;">ipcRenderer</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;hot-update-status&quot;</span><span style="color:#E1E4E8;">,(</span><span style="color:#FFAB70;">event</span><span style="color:#F97583;">:</span><span style="color:#B392F0;">IpcRendererEvent</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">msg</span><span style="color:#F97583;">:</span><span style="color:#B392F0;">updateInfo</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">switch</span><span style="color:#E1E4E8;"> (msg.status) {</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;downloading&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//   正在下载</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;moving&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//   正在移动文件</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;finished&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//   完成更新</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">case</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;failed&quot;</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#6A737D;">//   更新失败</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#F97583;">break</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">        }</span></span>
<span class="line"><span style="color:#E1E4E8;">    })</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">type</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">updateInfo</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">status</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#E36209;">message</span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">string</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#6A737D;">// 省略部分代码</span></span>
<span class="line"><span style="color:#6F42C1;">checkUpgrade</span><span style="color:#24292E;">(){</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// 请注意，ipcRenderer为electron提供的ipcRenderer方法</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6F42C1;">ipcRenderer</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;hot-update-status&quot;</span><span style="color:#24292E;">,(</span><span style="color:#E36209;">event</span><span style="color:#D73A49;">:</span><span style="color:#6F42C1;">IpcRendererEvent</span><span style="color:#24292E;">, </span><span style="color:#E36209;">msg</span><span style="color:#D73A49;">:</span><span style="color:#6F42C1;">updateInfo</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">switch</span><span style="color:#24292E;"> (msg.status) {</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;downloading&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//   正在下载</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;moving&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//   正在移动文件</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;finished&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//   完成更新</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">case</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;failed&quot;</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#6A737D;">//   更新失败</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">default</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#D73A49;">break</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">        }</span></span>
<span class="line"><span style="color:#24292E;">    })</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><table><thead><tr><th style="text-align:center;">状态类型</th><th style="text-align:center;">类型</th><th style="text-align:left;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">init</td><td style="text-align:center;">updateInfo</td><td style="text-align:left;">初始化</td></tr><tr><td style="text-align:center;">downloading</td><td style="text-align:center;">updateInfo</td><td style="text-align:left;">正在下载文件</td></tr><tr><td style="text-align:center;">moving</td><td style="text-align:center;">updateInfo</td><td style="text-align:left;">正在移动文件</td></tr><tr><td style="text-align:center;">finished</td><td style="text-align:center;">updateInfo</td><td style="text-align:left;">已完成</td></tr><tr><td style="text-align:center;">failed</td><td style="text-align:center;">updateInfo</td><td style="text-align:left;">失败，原因在 updateInfo 的 message 中</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">提醒</p><p>若你想体验热更新功能，你可以通过修改你的<code>package.json</code>的<code>version</code>对象，让它的值小于 1.0.0，然后修改渲染进程内的一些文件，能够看出和原仓库有明显区别之后，运行<code>yarn build:dir</code>命令，在打包完成以后，启动项目并点击检查热更新，即可看到效果。</p><p>目前暂时只支持走 github 的 page server，可能会因为你的地域限制，导致无法访问，如果你愿意等待，我将会在后续推出码云版本，若你需要马上看到效果，则你可能需要一些魔法。（欸嘿~）</p></div>`,18),o=[e];function t(c,r,i,y,E,d){return n(),a("div",null,o)}const h=s(p,[["render",t]]);export{b as __pageData,h as default};
